<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå°ç™»å½• - Xist2024</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        /* ä¸ºåå°ç‰¹å®šå…ƒç´ æ·»åŠ ä¸€äº›é¢å¤–æ ·å¼ */
        .motto-editor-container {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
        }
        #motto-editor {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            font-size: 1.1em;
            color: #fff;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            box-sizing: border-box;
            line-height: 1.6;
            resize: vertical;
        }
        #motto-editor:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.7);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }
        #save-mottos-button {
            width: 100%;
            margin-top: 15px;
            padding: 15px;
            font-size: 1.2em;
            font-weight: bold;
            color: #fff;
            background: rgba(80, 160, 255, 0.25);
            border: 1px solid rgba(80, 160, 255, 0.4);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #save-mottos-button:hover {
            background: rgba(80, 160, 255, 0.4);
        }
        #save-status {
            margin-top: 15px;
            color: #a5d6a7;
            font-weight: bold;
            height: 20px;
            text-align: center;
        }
    </style>
</head>
<body>

    <div id="login-interface">
        <div class="card-base login-card">
            <h1>åå°ç®¡ç†ç™»å½•</h1>
            <div id="error-msg" class="login-error-message"></div>
            <input type="password" id="password-input" placeholder="è¯·è¾“å…¥è®¿é—®å¯†ç ">
            <button id="login-button">ç™» å½•</button>
        </div>
    </div>

    <div id="backend-content" style="display: none;">
        <div class="card-base" style="max-width: 800px; padding: 40px; text-align: left;">
            <h2>ğŸ‰ æ¬¢è¿å›æ¥, Xist2024!</h2>
            <p>æ‚¨å·²æˆåŠŸç™»å½•åˆ°ç®¡ç†åå°ã€‚</p>
            
            <div class="motto-editor-container">
                <h3>æ ¼è¨€ç¼–è¾‘å™¨</h3>
                <p style="font-size: 0.9em; color: #ccc;">åœ¨è¿™é‡Œç®¡ç†æ‚¨çš„æ ¼è¨€åˆ—è¡¨ï¼Œæ¯æ¡æ ¼è¨€å ä¸€è¡Œã€‚ä¿å­˜åï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨å°†å†…å®¹å¤åˆ¶åˆ°é¡¹ç›®çš„ `mottos.txt` æ–‡ä»¶ä¸­ä»¥æ›´æ–°ä¸»é¡µã€‚</p>
                <textarea id="motto-editor" placeholder="æ­£åœ¨åŠ è½½æ ¼è¨€..."></textarea>
                <button id="save-mottos-button">ä¿ å­˜ ç¼– è¾‘</button>
                <div id="save-status"></div>
            </div>

            <br>
            <a href="/" style="color: #fff; text-decoration: none; font-weight: bold; margin-top: 20px; display: inline-block;">â¡ï¸ è¿”å›ä¸»é¡µ</a>
        </div>
    </div>

    <script>
        // --- JavaScript éªŒè¯ä¸åå°é€»è¾‘ ---

        // 1. åœ¨è¿™é‡Œè®¾ç½®ä½ çš„åå°å¯†ç 
        const CORRECT_PASSWORD = "xistyyds"; // è¯·åŠ¡å¿…ä¿®æ”¹ä¸ºä¸€ä¸ªæ›´å¤æ‚çš„å¯†ç ï¼

        // 2. è·å–é¡µé¢ä¸Šçš„å…ƒç´ 
        const loginInterface = document.getElementById('login-interface');
        const backendContent = document.getElementById('backend-content');
        const passwordInput = document.getElementById('password-input');
        const loginButton = document.getElementById('login-button');
        const errorMessage = document.getElementById('error-msg');
        
        // 3. ç™»å½•æˆåŠŸåè¦æ‰§è¡Œçš„æ“ä½œ
        function showBackend() {
            loginInterface.style.display = 'none'; // éšè—ç™»å½•æ¡†
            backendContent.style.display = 'block'; // æ˜¾ç¤ºåå°å†…å®¹
            loadMottosForEditing(); // æ–°å¢ï¼šåŠ è½½æ ¼è¨€åˆ°ç¼–è¾‘å™¨
        }

        // 4. å¤„ç†ç™»å½•è¯·æ±‚
        function attemptLogin() {
            if (passwordInput.value === CORRECT_PASSWORD) {
                showBackend();
            } else {
                errorMessage.textContent = 'å¯†ç é”™è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•ã€‚';
                passwordInput.value = '';
                passwordInput.focus();
            }
        }
        
        // 5. ç»‘å®šäº‹ä»¶
        loginButton.addEventListener('click', attemptLogin);
        passwordInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                attemptLogin();
            }
        });

        // --- æ–°å¢ï¼šæ ¼è¨€ç®¡ç†é€»è¾‘ ---
        const mottoEditor = document.getElementById('motto-editor');
        const saveMottosButton = document.getElementById('save-mottos-button');
        const saveStatus = document.getElementById('save-status');
        const MOTTOS_STORAGE_KEY = 'xist2024-mottos';

        // ä»æœåŠ¡å™¨æ–‡ä»¶æˆ–æœ¬åœ°å­˜å‚¨åŠ è½½æ ¼è¨€
        async function loadMottosForEditing() {
            const savedMottos = localStorage.getItem(MOTTOS_STORAGE_KEY);
            if (savedMottos) {
                mottoEditor.value = savedMottos;
                console.log('å·²ä»æµè§ˆå™¨æœ¬åœ°å­˜å‚¨åŠ è½½æ ¼è¨€ã€‚');
            } else {
                try {
                    const response = await fetch('../mottos.txt');
                    if (!response.ok) throw new Error('æ–‡ä»¶æœªæ‰¾åˆ°');
                    const text = await response.text();
                    mottoEditor.value = text;
                    console.log('å·²ä» mottos.txt æ–‡ä»¶åŠ è½½åˆå§‹æ ¼è¨€ã€‚');
                } catch (error) {
                    console.error('åŠ è½½ mottos.txt å¤±è´¥:', error);
                    mottoEditor.value = 'æ— æ³•åŠ è½½æ ¼è¨€æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚';
                }
            }
        }

        // å°†ç¼–è¾‘åçš„æ ¼è¨€ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveMottos() {
            const newMottos = mottoEditor.value;
            localStorage.setItem(MOTTOS_STORAGE_KEY, newMottos);
            saveStatus.textContent = 'âœ… å·²æˆåŠŸä¿å­˜åˆ°æ‚¨çš„æµè§ˆå™¨ï¼';
            setTimeout(() => {
                saveStatus.textContent = '';
            }, 3000);
        }

        saveMottosButton.addEventListener('click', saveMottos);

    </script>
</body>
</html>
